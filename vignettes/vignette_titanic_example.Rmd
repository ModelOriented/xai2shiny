---
title: "xai2shiny introduction: Titanic dataset with multiple models"
author: Adam Rydelek, Mateusz Polakowski
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{vignette_titanic_rf_glm_h2o}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = FALSE,
  comment = "#>",
  warning = FALSE,
  message = FALSE
)
```

```{r}
library("xai2shiny")
```

# Titanic dataset

`DALEX` packages provides an imputed version of a common classification-oriented dataset - `titanic` (data was copied from the `stablelearner` package).
Let's see a sample of observations:

```{r}
library("DALEX")
head(titanic_imputed, 3)
```

# Models to compare

Package allows to pass multiple models from different packages to the main function, so why not create some:

```{r}
library("ranger")

model_rf <- ranger(survived ~ .,
                   data = titanic_imputed,
                   classification = TRUE,
                   probability = TRUE)
model_glm <- glm(survived ~ .,
                 data = titanic_imputed,
                 family = "binomial")
```

# Explainers based on models

In fact, `xai2shiny` function accepts only explainers, i.e. `DALEX` special objects basing on provided models. Let's create all 3 explainers:

```{r}
explainer_rf <- explain(model_rf,
                    data = titanic_imputed[,-8],
                    y = titanic_imputed$survived)
explainer_glm <- explain(model_glm,
                data = titanic_imputed[,-8],
                      y = titanic_imputed$survived)
```

# Shiny application

After that, only thing left to do is to generate an app and run it:

```{r eval=FALSE}
xai2shiny(explainer_rf, explainer_glm, directory = './', run = FALSE)
```

# Cloud deployment

Further cloud deployment can be done in 2 simple steps (see [README example for details](https://github.com/ModelOriented/xai2shiny/blob/master/README.md)):

```{r eval=FALSE}
xai2shiny::cloud_setup()
my_droplet_id <- 1 # Compare it to your DigitalOcean account and set a proper ID 
deploy_shiny(droplet = my_droplet_id, path = './xai2shiny', packages = "ranger")
```

# External model's package

As the package covers as many external models sources as `DALEX`, let's consider widely known `h2o` package:

```{r eval=FALSE}
# library("h2o")
# h2o.init()
# 
# # Preparing data
# y <- "survived"
# x <- setdiff(names(titanic_imputed), y)
# 
# titanic_imputed_h2o <- as.h2o(titanic_imputed)
# frames <- h2o.splitFrame(data = titanic_imputed_h2o, ratios = 0.7)
# train <- frames[[1]]
# test <- frames[[2]]
#   
# # For binary classification, response should be a factor
# train[, y] <- as.factor(train[, y])
# test[, y] <- as.factor(test[, y])
# 
# # Creating model
# model_h2o <- h2o.automl(x = x, y = y, 
#                         training_frame = train,
#                         max_models = 10,
#                         seed = 1)
# 
# # Creating explainer
# explainer_h2o <- explain(model_h2o, data = titanic_imputed[,-8],
#                     y = titanic_imputed$survived)
# 
# # Running xai2shiny function, but omit running generated shiny application
# xai2shiny(explainer_h2o, directory = 'D:/Studia/test2', run = FALSE)
# 
# 
# 
# 
# 
# 
# 
# 
# library("lares") # devtools::install_github("laresbernardo/lares")
# model <- h2o_automl(titanic_imputed, "survived", quiet = FALSE)
# explainer <- h2o_explainer(model$datasets$test, model = model$model, y = "survived")
# xai2shiny(explainer, directory = 'D:/Studia/test2', run = FALSE)
```
